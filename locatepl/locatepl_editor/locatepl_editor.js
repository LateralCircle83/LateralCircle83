/**⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢀⠤⠤⠒⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢳⠀⢀⣴⠭⡄⠀⠀⢰⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠸⣀⡠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢳⠊⠀⠀⠣⢄⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢠⠊⠀⠠⠅⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⢀⠔⠀⣸⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢠⠃⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⢸⡄⠀⠀⠀⠀⠀⠀⠀⠀⢠⠤⡤⠊⠀⠀⠀⠀⡆⠀⠮⡌⠉⠒⠆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢰⠀⠰⠀⢸⠀⠀⠀⠀⠀⠀⠀⡄⣼⠈⢆⠀⠀⠀⠀⠀⠀⠀⢸⠀⠱⡀⠀⠀⢰⡏⠀⢠⠤⠃⠀⡠⠆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢸⠀⠂⠀⠨⡄⢀⡤⠀⠀⠀⠀⢱⠇⣠⠤⣷⣄⠀⠀⠀⠀⢀⠎⠀⠀⢱⠀⡗⠊⠀⠀⣰⠂⠀⠈⢑⡄⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠈⢢⢟⠀⠀⠘⢆⡉⠁⠀⣀⡔⠁⠀⡇⡎⣀⡉⢿⠒⠒⡒⠋⠀⠀⠀⠈⡌⢀⡀⢸⠇⠀⠀⠀⠛⡅⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠱⣄⠀⢘⣸⣇⣹⡄⠀⠀⠀⡃⡃⣃⣸⢘⠀⢠⠁⠀⠀⠀⠀⠀⡧⠊⠈⠁⠀⠀⠀⢲⡒⠁⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠓⠢⢿⣽⠯⡇⠀⠀⠀⠘⡌⣢⣄⡼⠀⡝⠀⠀⠀⠀⠀⢀⠃⠀⠀⠀⠀⠀⡆⠐⠃⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡀⠀⢰⠑⠷⠃⠀⠀⡀⠀⠀⠉⠁⠀⢰⠀⠀⠀⠀⠀⠀⡸⣤⠴⠶⠤⢔⣌⣁⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢠⡼⠝⢢⡬⣵⡚⠄⠀⢇⠀⠀⠁⠚⠀⠀⠀⠀⡨⠦⠤⠠⢤⠓⠘⠉⠀⠀⠀⠀⠀⠀⠉⠪⢕⢄⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢸⢸⠸⡿⣻⣭⡟⠛⢟⠛⣗⡿⠱⠀⠀⠀⡠⠚⠈⠙⠲⣄⠈⠱⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⣇⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢀⣀⠬⠿⠟⠛⢻⡾⠷⠤⠴⠿⠿⠤⣤⠖⡗⠋⠀⠀⠀⠀⠀⠈⢢⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢣⡀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠰⡀⠀⠀⠀⠀⠈⠁⠒⠒⠂⠤⠤⡏⠀⡘⠀⠀⠀⠀⠀⠀ ⠀⠀⠘⡄⠈⡄⠀⠀⠀⠀⠀⠀⠀ ⠀⠀⠀⠀⠣⡀⠀⠀⠀
⠀⠀⠀⠀⠀⢈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠁⠀⠁⠀⠀⠀⠀⠀⠀ ⠀⠀⠀⢡⢀⠁⠀⠀⠀⠀⠀⠀⠀  ⠀⠀⠀⠀⠀⢣⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠆⡨⠀⠀⠀⠀⠀⠀⠀⠀  ⠀⠀⠀⠀⠀⠀⠀⢅⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠢⢄⠀⠀⠀⠀⠀⠀⠀⠀⠱⡄⠀⠀⠀⠀⠀⠐⠒⠒⢠⡽⠜⢁⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠆⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠑⠂⠤⢠⡄⣀⣀⣀⡈⢦⣄⡀⠀⣀⣠⠴⠊⠉⠋⠈⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢩⠀
*作者：LateralCircle83
*开源地址：https://gitee.com/lateralcircle83/eval/tree/master/%E6%8C%87%E5%8D%97%E9%92%88
*本插件完全免费，如有侵权请立即举报
*/
//LiteLoaderScript Dev Helper
/// <reference path="d:\LateralCircle83\object/dts/llaids/src/index.d.ts"/> 

ll.registerPlugin("locatepl_editor", "rt", [1.0], { "只因": "你太美" })


class Git_form {
    constructor(pl, conf, world, num) {
        this.pl = pl
        this.conf = conf
        this.world = world
        this.num = num
    }
    // 主菜单区域
    setform_main() {
        let v = this.conf.version
        var c = []
        let p = []
        for (var t in this.conf) {
            if (t == "version") continue
            c.push(t)
            p.push("")
        }
        c.push("重载locatepl插件")
        c.push("还原结构文件")
        p.push("")
        p.push("")
        this.pl.sendSimpleForm("locatepl_editor", "当前model文件版本:" + v, c, p, (pl, id) => {
            if (id == null) return
            if (id==c.length-2) {mc.runcmd("ll reload locatepl");return}
            if (id==c.length-1) {File.delete(".//plugins//locatepl//locate_model.json");return}
            let conf_2 = this.conf[c[id]]
            let to_c_2 = new Git_form(pl, conf_2, c[id])
            to_c_2.setform_list()
        })
    }
    setform_list() {
        let c = []
        let p = []
        for (var t of this.conf) {
            let coname = t.cn_name || t.en_name || "null"
            let pa = t.picture || ""
            c.push(coname)
            p.push(pa)
        }
        c.push("添加一个结构")
        p.push("")
        this.pl.sendSimpleForm("locatepl_editor", "选择你要搞得玩意", c, p, (pl, id) => {
            if (id == null) return
            if (id == c.length - 1) {
                // 这里是添加结构
                let to_c_4 = new Git_form(pl, {}, this.world, null)
                to_c_4.setform_editor()
                return
            }
            // 这里选择改变方法
            var fme = mc.newCustomForm()
            fme.setTitle("选择变换方式")
            fme.addStepSlider("方式选择器", ["编辑结构", "删除结构"])
            pl.sendForm(fme, (pl, ias) => {
                switch (ias[0]) {
                    case 0:
                        // 这里是选择编辑
                        let conf_3 = this.conf[id]
                        let to_c_3 = new Git_form(pl, conf_3, this.world, id)
                        to_c_3.setform_editor()
                        break
                    case 1:
                        // 这里选择删除
                        file_to.delet(this.world, id)
                        pl.tell("[locatepl_editor]已删除配置")
                        break
                    default:
                        // 这里取消了
                        return
                }
            })
            /**let conf_3=this.conf[id]
            let to_c_3 =new Git_form(pl,conf_3,this.world,id)
            to_c_3.setform_editor()*/
        })
    }
    // 这里是编辑器ca
    setform_editor() {
        var fm = mc.newCustomForm()
        fm.setTitle(this.conf.cn_name || this.conf.en_name || "null")
        fm.addInput("结构名(必填)", this.conf.en_name || "",this.conf.en_name || "")
        fm.addInput("中文名(必填)", this.conf.cn_name || "",this.conf.cn_name || "")
        fm.addSwitch("是否允许被查找", Boolean(this.conf.allow_find))
        fm.addInput("在新区块查找用的money(必填)", String(this.conf.use_money_useNewChunksOnly),String(this.conf.use_money_useNewChunksOnly))
        fm.addInput("一般查找用的money(必填)", String(this.conf.use_money_common),String(this.conf.use_money_common))
        fm.addInput("图片(选填)", this.conf.picture || "",this.conf.picture || "")
        this.pl.sendForm(fm, (pl, arry) => {
            if (arry == null) return
            // 不知道怎么写了
            let file_td = new file_to(arry), back = file_td.fuck_back()
            if (!back) { file_td.write(this.world, this.num); pl.tell("[locatepl_editor]已经为您更改") } else {
                let h = new Git_form(pl, back, this.world, this.num)
                h.setform_editor()
            }
        })
    }
}
class file_to {
    constructor(arry) {
        this.arry = arry
    }
    write(world, id) {
        let conf = JSON.parse(File.readFrom(".//plugins//locatepl//locate_model.json"))
        if (id == null) {
            conf[world].push({
                "en_name": this.arry[0],
                "cn_name": this.arry[1],
                "allow_find": this.arry[2],
                "use_money_useNewChunksOnly": parseInt(this.arry[3]),
                "use_money_common": parseInt(this.arry[4]),
                "picture": this.arry[5]|| null
            })
        } else {
            conf[world][id].en_name = this.arry[0]
            conf[world][id].cn_name = this.arry[1]
            conf[world][id].allow_find = this.arry[2]
            conf[world][id].use_money_useNewChunksOnly = parseInt(this.arry[3])
            conf[world][id].use_money_common = parseInt(this.arry[4])
            conf[world][id].picture = this.arry[5] || null
        }
        File.writeTo(".//plugins//locatepl//locate_model.json", JSON.stringify(conf, null, "\t"))
    }
    static delet(world, id) {
        let conf = JSON.parse(File.readFrom(".//plugins//locatepl//locate_model.json"))
        conf[world].splice(id, 1)
        File.writeTo(".//plugins//locatepl//locate_model.json", JSON.stringify(conf, null, "\t"))
    }
    fuck_back() {
        if (this.arry[0] && this.arry[1] && this.arry[3] && this.arry[4]) { return false } else {
            let back_conf = {
                "en_name": this.arry[0],
                "cn_name": this.arry[1],
                "allow_find": this.arry[2],
                "use_money_useNewChunksOnly": this.arry[3],
                "use_money_common": this.arry[4],
                "picture": this.arry[5]|| null
            }
            return back_conf
        }
    }
}
// 说明命令
var cmd = mc.newCommand("locatepl_editor", "locatepl的查找结构编辑器")
cmd.setAlias("lcpl_e")
cmd.overload()
cmd.setCallback(function lcpl_e(_cmd,origin,_output,_re) {
    var pl=origin.player
    // 判断文件
    let xtr=File.exists(".//plugins//locatepl//locate_model.json")
    // 检测是否空子集
    if (xtr==false) {
        // 发送模式表单
        pl.sendModalForm("locatepl_editor", "找不到//plugins//locatepl//locate_model.json文件，请您确认是否存在locatepl插件", "我有locatepl插件", "我没有locatepl插件", (pl, b) => {
            // 标记下方异步时不执行
            // 菜单取消
            if (b == null) return
            // 菜单确认
            if (b == true) {
                // 获取数据
                network.httpGet("https://gitee.com/lateralcircle83/eval/raw/master/locatepl/date2.4.0/locate_model.json", (sta, str) => {
                    // 获取成功
                    if (sta == 200) {
                        // 写入
                        File.writeTo(".//plugins//locatepl//locate_model.json", str)
                        pl.tell("[locatepl_editor]已经为您下载了实例locate_model.json文件，您现在可以进行编辑")
                        // 获取失败
                    } else { pl.tell("[locatepl_editor]搞不定，自己看着办吧") }
                })
                // 气人屮
            } else { pl.tell("[locatepl_editor]淦，不用locatepl插件用locatepl_editor可还行？") }
        })
    }
    // 判断异步停止
    if (xtr == false) return
    let conf = JSON.parse(File.readFrom(".//plugins//locatepl//locate_model.json"))
    // 转移到类
    let to_c_1 = new Git_form(pl, conf)
    // 执行类
    to_c_1.setform_main()
})
cmd.setup()
// 命令回调
